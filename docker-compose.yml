version: "3.9"

services:
  # Trusted Agent Hub - エージェント審査プラットフォーム
  trusted-agent-hub:
    build:
      context: .
      dockerfile: ./trusted_agent_hub/Dockerfile
    container_name: trusted-agent-hub
    ports:
      - "8080:8080"
    environment:
      - DATABASE_URL=sqlite:////app/data/agent_store.db
      - GOOGLE_API_KEY=${GOOGLE_API_KEY}
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
      - WANDB_API_KEY=${WANDB_API_KEY}
      - WANDB_PROJECT=${WANDB_PROJECT:-agent-store-sandbox}
      - WANDB_ENTITY=${WANDB_ENTITY}
      - WANDB_BASE_URL=${WANDB_BASE_URL:-https://api.wandb.ai}
    volumes:
      - trusted-hub-data:/app/data
    networks:
      - agent-net
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  # Secure Mediation Agent - メディエーションエージェント（Web UI）
  secure_mediation_agent:
    build:
      context: .
      dockerfile: ./secure-mediation-agent/Dockerfile
    container_name: secure_mediation_agent
    ports:
      - "8000:8000"
    environment:
      - GOOGLE_API_KEY=${GOOGLE_API_KEY}
      - GOOGLE_GENAI_USE_VERTEXAI=${GOOGLE_GENAI_USE_VERTEXAI:-0}
    networks:
      - agent-net
    depends_on:
      - airline_agent
      - hotel_agent
      - car_rental_agent
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  # Airline Agent - 航空会社エージェント
  airline_agent:
    build:
      context: .
      dockerfile: ./external-agents/trusted-agents/airline_agent/Dockerfile
    container_name: airline_agent
    ports:
      - "8002:8002"
    environment:
      - GOOGLE_API_KEY=${GOOGLE_API_KEY}
      - GOOGLE_GENAI_USE_VERTEXAI=${GOOGLE_GENAI_USE_VERTEXAI:-0}
      - AGENT_HOST=airline_agent
      - AGENT_PORT=8002
    networks:
      - agent-net
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8002/a2a/airline_agent/.well-known/agent.json"]
      interval: 30s
      timeout: 10s
      retries: 3

  # Hotel Agent - ホテル予約エージェント
  hotel_agent:
    build:
      context: .
      dockerfile: ./external-agents/trusted-agents/hotel_agent/Dockerfile
    container_name: hotel_agent
    ports:
      - "8003:8003"
    environment:
      - GOOGLE_API_KEY=${GOOGLE_API_KEY}
      - GOOGLE_GENAI_USE_VERTEXAI=${GOOGLE_GENAI_USE_VERTEXAI:-0}
      - AGENT_HOST=hotel_agent
      - AGENT_PORT=8003
    networks:
      - agent-net
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8003/a2a/hotel_agent/.well-known/agent.json"]
      interval: 30s
      timeout: 10s
      retries: 3

  # Car Rental Agent - レンタカーエージェント
  car_rental_agent:
    build:
      context: .
      dockerfile: ./external-agents/trusted-agents/car_rental_agent/Dockerfile
    container_name: car_rental_agent
    ports:
      - "8004:8004"
    environment:
      - GOOGLE_API_KEY=${GOOGLE_API_KEY}
      - GOOGLE_GENAI_USE_VERTEXAI=${GOOGLE_GENAI_USE_VERTEXAI:-0}
      - AGENT_HOST=car_rental_agent
      - AGENT_PORT=8004
    networks:
      - agent-net
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8004/a2a/car_rental_agent/.well-known/agent.json"]
      interval: 30s
      timeout: 10s
      retries: 3

volumes:
  trusted-hub-data:

networks:
  agent-net:
    driver: bridge
